<?php require_once __DIR__ . '/../src/db.php'; session_start(); if(empty($_SESSION['admin_id'])){ header('Location: login.php'); exit; } if($_SERVER['REQUEST_METHOD']==='POST' && !empty($_POST['delete_photo'])){ $id = (int)$_POST['delete_photo']; $stmt = $pdo->prepare('SELECT file_path FROM photos WHERE id = ?'); $stmt->execute([$id]); $p = $stmt->fetch(); if($p){ @unlink(__DIR__ . '/../uploads/' . $p['file_path']); $pdo->prepare('DELETE FROM photos WHERE id = ?')->execute([$id]); } header('Location: photos.php'); exit; } $photos = $pdo->query('SELECT ph.*, u.name FROM photos ph JOIN users u ON u.id = ph.user_id ORDER BY ph.uploaded_at DESC')->fetchAll(); ?><!doctype html><html><head><meta charset="utf-8"><title>Manage Photos</title></head><body><h1>Manage Photos</h1><p><a href="index.php">Back to Dashboard</a></p><table border="1"><tr><th>ID</th><th>User</th><th>Preview</th><th>Primary</th><th>Action</th></tr><?php foreach($photos as $ph): ?><tr><td><?php echo $ph['id']; ?></td><td><?php echo htmlspecialchars($ph['name']); ?></td><td><?php if($ph['file_path']): ?><img src="../uploads/<?php echo htmlspecialchars($ph['file_path']); ?>" style="max-width:100px"><?php endif; ?></td><td><?php echo $ph['is_primary'] ? 'Yes' : 'No'; ?></td><td><form method="post" style="display:inline"><button name="delete_photo" value="<?php echo $ph['id']; ?>">Delete</button></form></td></tr><?php endforeach; ?></table></body></html>